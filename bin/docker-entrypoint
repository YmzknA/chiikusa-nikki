#!/bin/bash -e

# Change ownership of the app directory to the user, excluding node_modules
chown -R user:user /myapp
find /myapp -mindepth 1 -maxdepth 1 ! -name "node_modules" -exec chown -R user:user {} +

# If running the rails server then create or migrate existing database
if [ "${1}" == "./bin/rails" ] && [ "${2}" == "server" ]; then
  gosu user bundle exec rails db:prepare
fi

exec gosu user "$@"
