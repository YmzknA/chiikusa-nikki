<div class="min-h-screen p-2 sm:p-4" data-controller="diary-view">
  <!-- Flash Messages Area -->
  <div id="flash-messages">
    <%= render 'shared/flash', flash: flash %>
  </div>

  <!-- Mobile Header with Logo -->
  <div class="relative z-10 sm:hidden neuro-card p-4 mb-4 flex justify-center items-center">
    <%= link_to root_path do %>
      <%= image_tag "logo.png", alt: "Neuro Logo", class: "h-10 w-auto" %>
    <% end %>
    <div class="h-10 flex items-center ml-3">
      <%= render 'shared/watering' %>
    </div>
  </div>

  <!-- DaisyUI Tab Navigation -->
  <div class="flex justify-start items-center mb-4">
    <div class="tabs tabs-boxed tabs-sm" role="tablist" aria-label="Êó•Ë®òË°®Á§∫Âàá„ÇäÊõø„Åà">
      <input 
        type="radio" 
        name="diary_view_tabs" 
        class="tab" 
        aria-label="üìÖ „Ç´„É¨„É≥„ÉÄ„Éº"
        id="calendar-tab"
        checked="checked"
        data-action="change->diary-view#showCalendarView"
        role="tab"
        aria-selected="true"
        aria-controls="calendar-view"
      />
      
      <input 
        type="radio" 
        name="diary_view_tabs" 
        class="tab" 
        aria-label="üìã „É™„Çπ„Éà"
        id="list-tab"
        data-diary-view-target="listTab"
        data-action="change->diary-view#showListView"
        role="tab"
        aria-selected="false"
        aria-controls="list-view"
      />
    </div>

    <div id="month-filter" class="hidden justify-center mx-auto md:mx-2" data-diary-view-target="monthFilter">
      <%= form_with url: diaries_path, method: :get, class: "flex items-center gap-2", local: true do |form| %>
        <%= form.select :month, options_for_select(@available_months, @selected_month), 
          { selected: @selected_month }, 
          { id: "month-select", class: "neuro-input px-3 py-2 text-sm rounded-lg border-none", 
            data: { action: "change->diary-view#filterByMonth" },
            "aria-label": "Êúà„ÅßÁµû„ÇäËæº„Åø" } %>
          <% end %>
    </div>

  </div>


  <!-- Calendar View -->
  <div id="calendar-view" class="neuro-card p-3 sm:p-6 overflow-hidden" data-diary-view-target="calendarView" role="tabpanel" aria-labelledby="calendar-tab">
    <%= month_calendar(events: @diaries, attribute: :date, class: "table table-fixed w-full") do |date, diaries| %>
      <div class="neuro-calendar-cell py-2 sm:py-3 px-1 sm:px-2 min-h-[50px] sm:min-h-[60px] md:min-h-[80px] relative">
        <div class="text-xs sm:text-sm text-base-content/60 mb-1"><%= date.day %></div>

        <% if diaries.any? %>
          <% diary = diaries.first %>
          <%= link_to diary_path(diary) do %>
            <div class="w-full h-full flex items-center justify-center hover:scale-110 transition-transform">
              <%= render "diaries/weed", diary: diary %>
            </div>
          <% end %>
        <% else %>
          <%= link_to new_diary_path(date: date) do %>
            <div class="w-full h-full flex items-center justify-center hover:scale-110 transition-all duration-200">
              <div class="mask mask-hexagon-2 size-3 sm:size-5 md:size-8 flex items-center justify-center"> 
                <div class="size-full bg-base-300">
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- List View -->
  <div id="list-view" class="hidden" data-diary-view-target="listView" role="tabpanel" aria-labelledby="list-tab">
    <div class="grid gap-4 md:gap-6 sm:grid-cols-2 lg:grid-cols-3">
      <% @diaries.each do |diary| %>
        <div class="neuro-card p-4 md:p-6">
          <div class="flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2 mb-3">
            <span class="text-base md:text-lg font-semibold text-primary"><%= diary.date.strftime("%Y/%m/%d") %></span>
          </div>
          
          <% if diary.til_text.present? %>
            <h3 class="text-base md:text-lg font-bold text-primary mb-2">Today I Learned</h3>
            <p class="text-sm md:text-base leading-relaxed text-base-content mb-3 md:mb-4"><%= truncate(diary.til_text, length: 150) %></p>
          <% elsif diary.notes.present? %>
            <h3 class="text-base md:text-lg font-bold text-secondary mb-2">‰ªäÊó•„ÅÆ„É°„É¢</h3>
            <div class="text-sm md:text-base leading-relaxed text-base-content mb-3 md:mb-4 whitespace-pre-line"><%= truncate(diary.notes, length: 150) %></div>
          <% end %>

          <div class="flex gap-1 md:gap-2 mb-3 md:mb-4 flex-wrap">
            <% diary.diary_answers.each do |diary_answer| %>
              <div class="neuro-badge py-1 px-2 text-xs font-medium flex items-center gap-1">
                <span class="text-xl"><%= diary_answer.answer.emoji %></span>
              </div>
            <% end %>
          </div>

          <div class="flex justify-end">
            <%= link_to diary_path(diary), class: "neuro-button py-2 px-3 md:px-4 text-xs md:text-sm font-medium" do %>
              Ë©≥Á¥∞„ÇíË¶ã„Çã
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <% if @diaries.empty? %>
      <div class="neuro-card p-6 md:p-8 text-center">
        <h2 class="text-lg md:text-xl font-bold text-base-content mb-2">Êó•Ë®ò„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h2>
        <p class="text-sm md:text-base text-base-content/60">„Åæ„Å†Êó•Ë®ò„ÇíÊõ∏„ÅÑ„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÊúÄÂàù„ÅÆÊó•Ë®ò„ÇíÊõ∏„ÅÑ„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
        <%= link_to new_diary_path, class: "neuro-button py-2 px-4 text-sm font-medium mt-4 inline-block" do %>
          Êó•Ë®ò„ÇíÊõ∏„Åè
        <% end %>
      </div>
    <% end %>
  </div>
</div>
