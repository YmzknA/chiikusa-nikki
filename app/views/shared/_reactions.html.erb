<div id="reactions_<%= diary.id %>" class="mt-4 flex flex-wrap items-center gap-2"
     data-controller="reaction"
     data-reaction-diary-id-value="<%= diary.id %>"
     data-reaction-user-reactions-value="<%= diary.user_reactions(current_user).to_json %>"
     data-reaction-categories-value="<%= Reaction::EMOJI_CATEGORIES.to_json %>">
  
  <!-- 既存のリアクション表示 -->
  <% diary.reactions_summary.each do |emoji, count| %>
    <button class="flex items-center gap-1 px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded-full text-sm transition-colors
                   <%= 'bg-blue-100 ring-2 ring-blue-300' if diary.user_reacted?(current_user, emoji) %>"
            data-action="click->reaction#selectEmoji"
            data-emoji="<%= emoji %>">
      <span><%= emoji %></span>
      <span class="text-xs text-gray-600"><%= count %></span>
    </button>
  <% end %>
  
  <!-- リアクション追加ボタン -->
  <% if user_signed_in? %>
    <button class="flex items-center justify-center w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-full text-sm transition-colors"
            data-action="click->reaction#showModal"
            data-reaction-target="addButton">
      <span class="text-gray-600">+</span>
    </button>
  <% end %>
  
  <!-- リアクション選択モーダル -->
  <% if user_signed_in? %>
    <div class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50"
         data-reaction-target="modal"
         data-action="click->reaction#hideModal">
      <div class="bg-white rounded-lg p-6 m-4 max-w-md w-full"
           data-action="click->reaction#stopPropagation">
        <h3 class="text-lg font-semibold mb-4">リアクションを選択</h3>
        
        <% Reaction::EMOJI_CATEGORIES.each do |category_key, category_data| %>
          <div class="mb-4">
            <h4 class="text-sm font-medium text-gray-700 mb-2"><%= category_data[:label] %></h4>
            <div class="flex flex-wrap gap-2">
              <% category_data[:emojis].each do |emoji| %>
                <button class="flex items-center justify-center w-10 h-10 bg-gray-100 hover:bg-gray-200 rounded-full text-lg transition-colors
                               <%= 'bg-blue-100 ring-2 ring-blue-300' if diary.user_reacted?(current_user, emoji) %>"
                        data-action="click->reaction#selectEmoji"
                        data-emoji="<%= emoji %>"
                        data-reaction-target="emojiButton">
                  <%= emoji %>
                </button>
              <% end %>
            </div>
          </div>
        <% end %>
        
        <div class="flex justify-end mt-6">
          <button class="px-4 py-2 bg-gray-300 hover:bg-gray-400 rounded-lg transition-colors"
                  data-action="click->reaction#hideModal">
            キャンセル
          </button>
        </div>
      </div>
    </div>
  <% end %>
</div>